#!/bin/sh

DIR=/arch/pacman
pkglist -n > $DIR/main.txt &&
pkglist -m > $DIR/aur.txt &&
pacman -Q > $DIR/all.txt &&

# Update cached repositories
cd $DIR/aur &&
paccache -rvc . -k1;
ls *.pkg.tar.xz > current.txt &&
files=$(comm -23 current.txt last.txt)
repo-add local-aur.db.tar.gz $files &&
mv current.txt last.txt

cd $DIR/main &&
rsync -av /var/cache/pacman/pkg/ ./ &&
paccache -rvc . -k1;
ls *.pkg.tar.xz > current.txt &&
files=$(comm -23 current.txt last.txt)
repo-add local-main.db.tar.gz $files &&
mv current.txt last.txt &&

# Sync pacman local db
sudo pacman --config=$DIR/pacman.conf -Sy
