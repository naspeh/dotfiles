#!/bin/sh
q="select * from weather.forecast where u='c' and woeid in (select woeid from geo.places where text='UA Yaremche' limit 1)"

function usage {
    echo "Usage: $0: [-v] [-i INDENT]"
    exit 2
}

while getopts "vc:i:" opt; do
    case $opt in
        c) city=$OPTARG;;
        v) verbose=1;;
        i) indent=$OPTARG;;
        ?) usage;;
    esac
done

r=$(curl -s "http://query.yahooapis.com/v1/public/yql?format=xml" --data-urlencode "q=$q")
[ $? != 0 ] && exit 1

if [ $verbose ]; then
    weather=$(echo "$r" | grep -A3 "Forecast:" | sed "s/<[^>]*>//g" | sed "1d")
else
    weather=$(echo "$r" | grep "C<BR" | cut -d"<" -f1)
fi

echo "$weather" | while read -r line; do
    case $line in
        *Snow*) symbol="❄";;
        *Rain*|*Shower*) symbol="☂";;
        *Thunderstorm*) symbol="☈";;
        *Lightning*) symbol="☇";;
        *) symbol="☀";;
    esac
    echo "$indent$symbol $line"
done
