#!/bin/bash
city=UPXX0010

function usage {
    echo "Usage: $0: [-v] [-c CITY]"
    exit 2
}

while getopts "c:v" opt; do
case $opt in
    c) city=$OPTARG;;
    v) verbose=1;;
    ?) usage;;
esac
done

response=$(curl -s "http://weather.yahooapis.com/forecastrss?u=c&p=$city")
if [ $verbose ]; then
    weather=$(echo "$response" | grep -A5 "C<BR" | sed "s/<[^>]*>//g" | sed "2d")
else
    weather=$(echo "$response" | grep "C<BR" | cut -d"<" -f1)
fi

case $(echo "$weather" | head -n1) in
    *Rain*) symbol="☂";;
    *Snow*) symbol="❄";;
    *) symbol='☀';;
esac
[[ $symbol ]] && weather=$symbol" "$weather

echo "$weather"
