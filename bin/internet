#!/bin/zsh
OK=OK
function check {
    if [ '0' = $(ping -c1 -W1 google.com | grep -c "1 received") ]; then
        rm -f /tmp/internet-up
        exit 1
    fi
    touch /tmp/internet-up
    echo $OK
}

if [ "$1" = "down" ]; then
    netctl stop-all
    exit
fi

if [ "$1" = "wifi" ]; then
    netctl start keenetic
    exit
fi

if [ "$1" = "ppp" ]; then
    netctl stop-all
    netctl start ppp-it
    exit
fi

if [ "$1" = "kill" ]; then
    killall dropbox gajim skype skype-call-recorder chromium
    exit
fi

if [ "$1" = "check" ]; then
    [ -f /tmp/internet-up ] && echo $OK
    exit
fi

if [ "$1" = "real-check" ]; then
    check > /dev/null
    exit
fi

# Wait for the internet
while [ "$(check)" != $OK ]; do sleep 1; done

if [ ! "$DISPLAY" ]; then
    export DISPLAY=:0
fi

if [ "$1" = "skype" ]; then
    skype &
    #skype-call-recorder &
    exit
fi

if [ "$SESSION" = "i3" ]; then
    i3-msg 'workspace 1: web; exec chromium'
else
    chromium
fi

[ "$1" = "light" ] && exit

dropbox &
#(sleep 1; gajim) &
