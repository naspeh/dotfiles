#!/bin/sh
set -xe

case "$1" in
lock)
    i3lock -p default --indicator --clock --blur 10 --inside-color=#cccccc
    # i3lock -p default --indicator --clock --blur 10 --timestr="%H:%M:%S" --timecolor '#eeeeeeee' --datecolor '#eeeeeeee'
    gpg-connect-agent --no-autostart reloadagent /bye
    xset dpms force off
;;
lang)
    if [ "$(setxkbmap -print | grep -c us+ua)" == "1" ]; then
        setxkbmap -layout "us,ru" -option "grp:caps_toggle,grp_led:caps"
    else
        setxkbmap -layout "us,ua" -option "grp:caps_toggle,grp_led:caps"
    fi
;;
monitor)
    if [ "$(hostnamectl hostname)" == "cat" ]; then
        laptop_cmd="xrandr --output eDP1 --auto --output DP2 --off"
        monitor_cmd="xrandr --output eDP1 --off --output DP2 --mode 2560x1440 --rate 74.99"
    else
        laptop_cmd="xrandr --output eDP-1 --auto --output DP-2 --off"
        monitor_cmd="xrandr --output eDP-1 --off --output DP-2 --auto "
    fi
    if [[ "$(xrandr| grep '.*mm x .*mm' | cut -d ' ' -f1)" == eDP* ]]; then
        $monitor_cmd
    else
        $laptop_cmd
    fi
;;
prettyurl)
    python2 -c "import urllib; print(urllib.unquote('''$(xsel -o)'''));" | xsel -ib
;;
prettyjson)
    xsel -o | python3 -m json.tool --sort-keys | xsel -ib
;;
qrcode-copy)
    xsel -o > /tmp/qrcode.txt
    convert inline:/tmp/qrcode.txt /tmp/qrcode.png
    zbarimg /tmp/qrcode.png | xsel -ib
;;
qrcode-png)
    zbarimg ~/Downloads/qrcode.png | xsel -ib
;;
qrcode-svg)
    zbarimg ~/Downloads/qrcode.svg | xsel -ib
;;
*)
    echo $"Usage: $0 {lock|lang|prettyurl|qrcode|qrcode-downloads}"
    exit 1
esac
