#!/usr/bin/env python
import subprocess

name = subprocess.check_output('expac -Q "%n %v" linux', shell=True)
name = name.decode().strip()

with open('/boot/loader/entries/arch.conf', 'br') as f:
    conf = f.read().decode()

conf = conf.replace('/vmlinuz-linux', '/vmlinuz-linux-bak')
conf = conf.replace('/initramfs-linux.img', '/initramfs-linux-bak.img')
conf = '# {}\n{}'.format(name,  conf)

with open('/boot/loader/entries/arch-bak.conf', 'bw') as f:
    f.write(conf.encode())

subprocess.call(
    'cp /boot/vmlinuz-linux /boot/vmlinuz-linux-bak'
    '&& cp /boot/initramfs-linux.img /boot/initramfs-linux-bak.img',
    shell=True
)
