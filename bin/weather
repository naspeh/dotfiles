#!/bin/sh
# http "http://query.yahooapis.com/v1/public/yql?q=select * from weather.forecast where u = 'c' and woeid in (select woeid from geo.places where text = 'UA Yaremche' limit 1)&format=xml"
city=UPXX0040
#city=UPXX5621

function usage {
    echo "Usage: $0: [-v] [-c CITY] [-i INDENT]"
    exit 2
}

while getopts "vc:i:" opt; do
    case $opt in
        c) city=$OPTARG;;
        v) verbose=1;;
        i) indent=$OPTARG;;
        ?) usage;;
    esac
done

response=$(curl -s "http://weather.yahooapis.com/forecastrss?u=c&p=$city")
[ $? != 0 ] && exit 1

if [ $verbose ]; then
    weather=$(echo "$response" | grep -A3 "Forecast:" | sed "s/<[^>]*>//g" | sed "1d")
else
    weather=$(echo "$response" | grep "C<BR" | cut -d"<" -f1)
fi

echo "$weather" | while read -r line; do
    case $line in
        *Snow*) symbol="❄";;
        *Rain*|*Shower*) symbol="☂";;
        *Thunderstorm*) symbol="☈";;
        *Lightning*) symbol="☇";;
        *) symbol="☀";;
    esac
    echo "$indent$symbol $line"
done
