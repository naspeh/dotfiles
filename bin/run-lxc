#!/bin/bash
# http://redsymbol.net/articles/unofficial-bash-strict-mode/
set -exuo pipefail

path=${path:-$(pwd)}
name=${name:-$(basename -- "$path")}

lxc-create -t download -n $name -- -d ubuntu -r xenial -a amd64
#lxc-create -t download -n $name -- -d archlinux -r current -a amd64

# mount src from host and also some cache directories
[ -z "$path" ] || (
cache=$path/.cache/$name
mkdir -p $cache/{root,home}
cat <<EOF >> /var/lib/lxc/$name/config
lxc.mount.entry = $path opt/$name none bind,create=dir
lxc.mount.entry = $cache/root root none bind,create=dir
lxc.mount.entry = $cache/home home none bind,create=dir
EOF
unset cache
)

lxc-start -n $name
