#!/bin/sh
set -x

case "$1" in
bat)
    if [ "$(acpi -b | grep -c Discharging)" == "1" ]; then
        rem_time=$(acpi -b | awk '{print $(NF-1)}')
        hrs=$(date --date="$rem_time" +%H)
        mins=$(date --date="$rem_time" +%M)
        rem_mins=$(echo "$hrs*60 + $mins" | bc)
        [ $rem_mins -le 5 ] && systemctl poweroff || exit 0;
    fi
;;
todo)
    pygmentize -O "font_name=Liberation Mono,font_size=16" -o ~/todo.png ~/todo.rst
    convert ~/todo.png -background "#000" -gravity center -extent 1366x768 ~/todo.png
    my bg
;;
lock)
    i3lock -i ~/todo.png
;;
bg)
    feh -R 30 --bg-center ~/todo.png
;;
lang)
    if [ "$(setxkbmap -print | grep -c us+ua)" == "1" ]; then
        setxkbmap -layout "us,ru" -option "grp:caps_toggle,grp_led:caps"
    else
        setxkbmap -layout "us,ua" -option "grp:caps_toggle,grp_led:caps"
    fi
;;
prettyurl)
    python2 -c "import urllib; print(urllib.unquote('''$(xclip -o)'''));" | xclip -selection c
;;
*)
    echo $"Usage: $0 {todo|lock|bg|bat}"
    exit 1
esac
